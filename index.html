<html>
  <head>

  </head>

  <body>

    <div class="main-container">

      <h1>Filter Events Demo</h1>

      <ul class="filter-list">
        <li>
          <label for="">
            <input name="one" type="checkbox" value="one" /> One
          </label>
        </li>
        <li>
          <label for="">
            <input name="two" type="checkbox" value="two" /> Two
          </label>
        </li>
        <li>
          <label for="">
            <input name="three" type="checkbox" value="three" /> Three
          </label>
        </li>
        <li>
          <label for="">
            <input name="four" type="checkbox" value="four" /> Four
          </label>
        </li>
      </ul>

      <hr />

      <ul class="message-list"></ul>

    </div>



    <script src="jquery.min.js"></script>
    <script src="lodash.min.js"></script>
    <script src="app.js"></script>

    <script>

      (function($, demo) {

        $(start);

        function start() {

          var list, filters, messageBus;

          // faking the messageBus for now
          messageBus = (function() {
            var self, subscribers = {};

            self = {
              publish: publish,
              subscribe: subscribe
            };

            return self;

            function subscribe(topic, subscriber, handler) {
              subscribers[topic] = subscribers[topic] || [];

              subscribers[topic].push({
                sub: subscriber,
                handler: handler
              });

              return self;
            }

            function publish(name, data) {
              console.log('message bus triggered', name, data);

              var targets = subscribers[name];

              if (!targets) {
                console.log('no targets for ', name);
                return;
              }

              targets.forEach(function callTargetHandler(target) {
                // call the handler function, setting the subscribing argument as the `this` context
                target.handler.call(target.sub, data);
              });
            }
          })();

          list = demo.MessageList({
            view: $('.message-list'),
            dom: $
          });

          list.render([
            {
              message: 'Hello There'
            }
          ]);

          filters = demo.FilterList({
            view: $('.filter-list'),
            dom: $
          }, messageBus);
        }

      })(jQuery, demo);

    </script>
  </body>
</html>
